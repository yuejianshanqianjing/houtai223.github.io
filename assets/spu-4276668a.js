import{H as z,G as Z,r as p,d as K,J as W,o as X,k as s,a as y,c as C,j as e,l as t,e as l,F as E,g as B,b as R,h as U,K as ee,E as G,m as H,y as M,t as le,_ as te,w as ae,q as Q}from"./index-059ef627.js";import{a as ue,g as ne,d as oe}from"./index-195b1a8b.js";let se=(b,m,n)=>z({url:`/admin/product/${b}/${m}?category3Id=${n}`,method:"get"}),de=()=>z({url:"/admin/product/baseTrademark/getTrademarkList",method:"get"}),ie=b=>z({url:`/admin/product/spuImageList/${b}`,method:"get"}),re=b=>z({url:`/admin/product/spuSaleAttrList/${b}`,method:"get"}),pe=()=>z({url:"/admin/product/baseSaleAttrList",method:"get"}),ce=b=>b.id?z.post("/admin/product/updateSpuInfo",b):z.post("/admin/product/saveSpuInfo",b),J=Z("spuStore",()=>{let b=p(""),m=p(""),n=p(""),S=p(""),o=p(""),f=p([]),V=async()=>{const u=await de();u.code==200&&(f.value=u.data)},L=p([]),r=async()=>{const u=await ie(b.value);L.value=u.data},x=p([]),P=async()=>{const u=await re(b.value);x.value=u.data},_=p([]),a=async()=>{const u=await pe();_.value=u.data},v=p([]);return{SpuPinpai:f,getSpuPinpai:V,spuId:b,name:m,desc:n,getimage:r,getattr:P,getAllsale:a,imgList:L,attrList:x,AllSale:_,tmId:S,c3id:o,attrData:v}});const me=["src"],_e=K({__name:"skuform",props:["data"],emits:["changeScene"],setup(b,{emit:m}){const n=b,S=J();let o=()=>{m("changeScene",{isShow:0,params:""})};console.log(n.data,333);const f=W(),V=J();let L=async()=>{let _=await ee(f.c1id,f.c2id,f.c3id);V.spuId=n.data.id,V.getimage(),V.getattr(),V.attrData=_.data,r.value.category3Id=f.c3id,r.value.spuId=n.data.id,r.value.tmId=n.data.tmId};X(()=>{L()});let r=p({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[{attrId:"",valueId:""}],skuSaleAttrValueList:[{saleAttrId:"",saleAttrValueId:""}],skuDefaultImg:""}),x=_=>{r.value.skuDefaultImg=_.imgUrl},P=async()=>{r.value.skuAttrValueList=S.attrData.reduce((a,v)=>{if(v.attidAndvalueId){let[u,h]=v.attidAndvalueId.split(":");a.push({attrId:u,valueId:h})}return a},[]),r.value.skuSaleAttrValueList=S.attrData.reduce((a,v)=>{if(v.saleIdandValueId){let[u,h]=v.saleIdandValueId.split(":");a.push({attrId:u,valueId:h})}return a},[]),(await ue(r.value)).code==200&&G({type:"success",message:"添加成功"}),m("changeScene",{isShow:0,params:""})};return(_,a)=>{const v=s("el-input"),u=s("el-form-item"),h=s("el-option"),D=s("el-select"),$=s("el-form"),N=s("el-table-column"),A=s("el-button"),T=s("el-table"),d=s("el-from"),k=s("el-card");return y(),C("div",null,[e(k,null,{default:t(()=>[e(d,null,{default:t(()=>[e(u,{label:"sku名称","label-width":"80"},{default:t(()=>[e(v,{modelValue:l(r).skuName,"onUpdate:modelValue":a[0]||(a[0]=i=>l(r).skuName=i)},null,8,["modelValue"])]),_:1}),e(u,{label:"价格(元)","label-width":"80"},{default:t(()=>[e(v,{modelValue:l(r).price,"onUpdate:modelValue":a[1]||(a[1]=i=>l(r).price=i)},null,8,["modelValue"])]),_:1}),e(u,{label:"重量","label-width":"80"},{default:t(()=>[e(v,{modelValue:l(r).weight,"onUpdate:modelValue":a[2]||(a[2]=i=>l(r).weight=i)},null,8,["modelValue"])]),_:1}),e(u,{label:"sku描述","label-width":"80"},{default:t(()=>[e(v,{type:"textarea",modelValue:l(r).skuDesc,"onUpdate:modelValue":a[3]||(a[3]=i=>l(r).skuDesc=i)},null,8,["modelValue"])]),_:1}),e(u,{label:"平台属性","label-width":"80"},{default:t(()=>[e($,{inline:!0},{default:t(()=>[(y(!0),C(E,null,B(l(S).attrData,i=>(y(),H(u,{key:i.id,label:i.attrName},{default:t(()=>[e(D,{modelValue:i.attidAndvalueId,"onUpdate:modelValue":c=>i.attidAndvalueId=c},{default:t(()=>[(y(!0),C(E,null,B(i.attrValueList,c=>(y(),H(h,{key:c.id,label:c.valueName,value:`${i.id}:${c.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(u,{label:"销售属性","label-width":"80"},{default:t(()=>[e($,{inline:!0},{default:t(()=>[(y(!0),C(E,null,B(l(S).attrList,i=>(y(),H(u,{key:i.id,label:i.saleAttrName},{default:t(()=>[e(D,{modelValue:i.saleIdandValueId,"onUpdate:modelValue":c=>i.saleIdandValueId=c},{default:t(()=>[(y(!0),C(E,null,B(i.spuSaleAttrValueList,c=>(y(),H(h,{key:c.id,label:c.saleAttrValueName,value:`${i.id}:${c.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(u,{label:"图片名称"},{default:t(()=>[e(T,{border:"",data:l(V).imgList,"highlight-current-row":""},{default:t(()=>[e(N,{type:"index",width:"80px",align:"center"}),e(N,{label:"图片"},{default:t(({row:i,$index:c})=>[R("img",{src:i.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,me)]),_:1}),e(N,{label:"名称",prop:"imgName"}),e(N,{label:"操作"},{default:t(({row:i,$index:c})=>[e(A,{type:"primary",size:"small",onClick:w=>l(x)(i)},{default:t(()=>[U("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(u,null,{default:t(()=>[e(A,{type:"primary",size:"default",onClick:l(P)},{default:t(()=>[U("保存")]),_:1},8,["onClick"]),e(A,{type:"primary",size:"default",onClick:l(o)},{default:t(()=>[U("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})])}}}),ge=["src"],fe=K({name:"spuform"}),ve=K({...fe,emits:["hello"],setup(b,{emit:m}){const n=J();let S=()=>{m("hello",0)},o=p({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[],spuId:n.spuId});o.value.spuName=n.name,o.value.description=n.desc,o.value.tmId=n.tmId,o.value.spuImageList=n.imgList.map(_=>({name:_.imgName,url:_.imgUrl})),o.value.spuSaleAttrList=n.attrList,o.value.category3Id=n.c3id,console.log(o.value.spuImageList,888);let f=p(!1),V=p(""),L=_=>{f.value=!0,V.value=_.url},r=()=>{console.log(123)};const x=(_,a)=>{_.spuSaleAttrValueList.splice(a,1)};n.attrList,n.AllSale;let P=async()=>{o.value.spuImageList=n.imgList;let _=await ce(o.value);o.value.spuImageList=n.imgList.map(a=>({name:a.imgName,url:a.imgUrl})),_.code==200&&(G({type:"success",message:o.value.spuId?"更新成功":"添加成功"}),m("hello",0))};return(_,a)=>{const v=s("el-input"),u=s("el-form-item"),h=s("el-option"),D=s("el-select"),$=s("Plus"),N=s("el-icon"),A=s("el-upload"),T=s("el-dialog"),d=s("el-button"),k=s("el-table-column"),i=s("el-tag"),c=s("el-table"),w=s("el-form"),q=s("el-card");return y(),C("div",null,[e(q,null,{default:t(()=>[e(w,null,{default:t(()=>[e(u,{label:"spu名称"},{default:t(()=>[e(v,{placeholder:"请输入spu名称",modelValue:l(o).spuName,"onUpdate:modelValue":a[0]||(a[0]=g=>l(o).spuName=g),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(u,{label:"spu品牌"},{default:t(()=>[e(D,{modelValue:l(o).tmId,"onUpdate:modelValue":a[1]||(a[1]=g=>l(o).tmId=g)},{default:t(()=>[(y(!0),C(E,null,B(l(n).SpuPinpai,g=>(y(),H(h,{key:g.id,label:g.tmName,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"spu描述"},{default:t(()=>[e(v,{placeholder:"请输入spu描述",modelValue:l(o).description,"onUpdate:modelValue":a[2]||(a[2]=g=>l(o).description=g),style:{height:"100px"}},null,8,["modelValue"])]),_:1}),e(u,{label:"SPU照片"},{default:t(()=>[e(A,{"file-list":l(o).spuImageList,"onUpdate:fileList":a[3]||(a[3]=g=>l(o).spuImageList=g),action:"/admin/product/fileUpload","list-type":"picture-card","on-preview":l(L),"on-remove":l(r)},{default:t(()=>[e(N,null,{default:t(()=>[e($)]),_:1})]),_:1},8,["file-list","on-preview","on-remove"]),e(T,{modelValue:l(f),"onUpdate:modelValue":a[4]||(a[4]=g=>M(f)?f.value=g:f=g)},{default:t(()=>[R("img",{"w-full":"",src:l(V),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,ge)]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"SPU销售属性"},{default:t(()=>[e(D,{placeholder:"请选择"},{default:t(()=>[e(h,{label:"北京",value:"1"}),e(h,{label:"上海",value:"2"})]),_:1}),e(d,{type:"primary",ico:"Plus",style:{"margin-left":"10px"}},{default:t(()=>[U("添加销售属性")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(c,{border:"",data:l(o).spuSaleAttrList},{default:t(()=>[e(k,{type:"index",align:"center",width:"80",label:"序号"}),e(k,{label:"属性名",prop:"saleAttrName"}),e(k,{label:"属性值"},{default:t(({row:g,$index:F})=>[(y(!0),C(E,null,B(g.spuSaleAttrValueList,j=>(y(),H(i,{key:j.id,class:"mx-1",closable:"",type:j.type,style:{margin:"5px 5px"},onClose:I=>x(g,F)},{default:t(()=>[U(le(j.saleAttrValueName),1)]),_:2},1032,["type","onClose"]))),128))]),_:1}),e(k,{label:"操作"},{default:t(({row:g,$index:F})=>[e(d,{type:"primary",size:"small",icon:"Delete"})]),_:1})]),_:1},8,["data"])]),_:1}),e(u,{class:"toright"},{default:t(()=>[e(d,{type:"primary",onClick:l(P)},{default:t(()=>[U("保存")]),_:1},8,["onClick"]),e(d,{onClick:l(S)},{default:t(()=>[U("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})])}}});const ye=te(ve,[["__scopeId","data-v-078a851a"]]),be={key:0},ke={class:"demo-pagination-block"},Ie=["src"],Se={key:1},Ve={key:2},Ae=K({__name:"spu",setup(b){const m=J();let n=p(0);const S=W();let o=p(1),f=p(3),V=p(),L=p([]),r=async()=>{const d=await se(o.value,f.value,S.c3id);d.code==200&&(L.value=d.data.records,V.value=d.data.total)};ae(()=>S.c3id,()=>{L.value=[],S.c3id&&(o.value=1,r())}),X(()=>{S.c3id&&r()});let x=d=>{r()},P=d=>{r()},_=()=>{n.value=1,m.getSpuPinpai()},a=d=>{n.value=1,console.log(d),m.spuId=d.id,m.name=d.spuName,m.desc=d.description,m.tmId=d.tmId,m.c3id=d.category3Id,m.getSpuPinpai(),m.getimage(),m.getattr(),m.getAllsale()},v=p(),u=d=>{v.value=d,n.value=2},h=d=>{n.value=d,r()},D=d=>{n.value=d.isShow},$=p([]),N=async d=>{A.value=!0;const k=await ne(d.id);k.code==200&&($.value=k.data)},A=p(!1),T=async d=>{(await oe(d.id)).code==200?(r(),G({type:"success",message:"删除成功"})):G({type:"warning",message:"删除失败"})};return(d,k)=>{const i=s("category"),c=s("el-button"),w=s("el-table-column"),q=s("el-table"),g=s("el-pagination"),F=s("el-card"),j=s("el-dialog");return y(),C("div",null,[e(i,{scene:l(n)},null,8,["scene"]),l(n)==0?(y(),C("div",be,[e(F,{style:{"margin-top":"10px"}},{default:t(()=>[e(c,{type:"primary",icon:"Plus",onClick:l(_),disabled:!l(S).c3id,style:{"margin-bottom":"10px"}},{default:t(()=>[U("添加SPU")]),_:1},8,["onClick","disabled"]),e(q,{border:"",data:l(L)},{default:t(()=>[e(w,{type:"index",label:"序号",wideth:"80",align:"center"}),e(w,{label:"spu名称",prop:"spuName"}),e(w,{label:"spu描述",prop:"description"}),e(w,{label:"操作"},{default:t(({row:I,$index:Y})=>[e(c,{icon:"Plus",type:"primary",size:"small",title:"添加sku",onClick:O=>l(u)(I)},null,8,["onClick"]),e(c,{icon:"Edit",type:"success",size:"small",title:"修改spu",onClick:O=>l(a)(I)},null,8,["onClick"]),e(c,{icon:"View",type:"info",size:"small",title:"查看sku列表",onClick:O=>l(N)(I)},null,8,["onClick"]),e(c,{icon:"Delete",type:"warning",size:"small",title:"删除spu",onClick:O=>l(T)(I)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),R("div",ke,[e(g,{"page-sizes":[3,5,7,10],background:!0,layout:" prev, pager, next, jumper,->, sizes,total",total:l(V),style:{"margin-top":"10px"},"current-page":l(o),"onUpdate:currentPage":k[0]||(k[0]=I=>M(o)?o.value=I:o=I),"page-size":l(f),"onUpdate:pageSize":k[1]||(k[1]=I=>M(f)?f.value=I:f=I),onSizeChange:l(x),onCurrentChange:l(P)},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])]),_:1})])):Q("",!0),e(j,{modelValue:l(A),"onUpdate:modelValue":k[2]||(k[2]=I=>M(A)?A.value=I:A=I),title:"Sku列表"},{default:t(()=>[e(q,{data:l($)},{default:t(()=>[e(w,{label:"sku名字",prop:"skuName"}),e(w,{label:"sku价格",prop:"price"}),e(w,{label:"sku重量",prop:"weight"}),e(w,{label:"sku价格"},{default:t(({row:I,$index:Y})=>[R("img",{src:I.skuDefaultImg,alt:"暂无图片",style:{width:"200px",height:"200px"}},null,8,Ie)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),l(n)==1?(y(),C("div",Se,[e(ye,{onHello:l(h)},null,8,["onHello"])])):Q("",!0),l(n)==2?(y(),C("div",Ve,[e(_e,{onChangeScene:l(D),data:l(v)},null,8,["onChangeScene","data"])])):Q("",!0)])}}});export{Ae as default};
