import{C as x,d as O,r as s,o as ce,k as p,a as S,c as M,j as l,l as t,e as n,y as h,F as j,D as fe,h as d,b as A,m as F,q as ve,g as ge,E as w,t as _e}from"./index-059ef627.js";let G=(i,U,c="")=>x({url:`/admin/acl/user/${i}/${U}/?username=${c}`,method:"get"}),ye=i=>i.id?x({url:"/admin/acl/user/update",method:"put",data:i}):x({url:"/admin/acl/user/save",method:"post",data:i}),H=i=>x({url:`/admin/acl/user/toAssign/${i}`,method:"get"}),Ce=i=>x({url:"/admin/acl/user/doAssignRole",method:"post",data:i}),J=i=>x({url:"/admin/acl/user/batchRemove",method:"delete",data:i});const he={class:"demo-pagination-block"},be=A("h4",null,"添加用户",-1),ke={style:{flex:"auto"}},Ve={style:{flex:"auto"}},we=O({name:"yh"}),Re=O({...we,setup(i){let U=s([]),c=s(1),b=s(3),I=s(10),g=async()=>{const a=await G(c.value,b.value);a.code==200&&(U.value=a.data.records,I.value=a.data.total)};ce(()=>g());let Q=a=>{c.value=1,b.value=a,g()},W=a=>{c.value=a,g()},v=s(!1),X=()=>{var a,e,u;r.value.name="",r.value.password="",r.value.username="",r.value.id=0,(a=C.value)==null||a.clearValidate("username"),(e=C.value)==null||e.clearValidate("name"),(u=C.value)==null||u.clearValidate("password"),v.value=!0},r=s({name:"",password:"",username:""}),C=s(null),Y=async()=>{var e;await((e=C.value)==null?void 0:e.validate());const a=await ye(r.value);a.code==200?(r.value.id||(c.value=1),g(),w({type:"success",message:r.value.id?"修改成功":"添加成功"})):w({type:"error",message:r.value.id?a.data:"添加失败"}),v.value=!1},Z=a=>{var e,u,m;(e=C.value)==null||e.clearValidate("username"),(u=C.value)==null||u.clearValidate("name"),(m=C.value)==null||m.clearValidate("password"),v.value=!0,r.value.name=a.name,r.value.password="",r.value.username=a.username,r.value.id=a.id};const ee={username:[{required:!0,trigger:"blur",validator:(a,e,u)=>{e.trim().length>=5?u():u(new Error("用户名称至少五位"))}}],name:[{required:!0,trigger:"blur",message:"昵称不能为空"},{min:5,message:"昵称至少五位"}],password:[{required:!0,trigger:"blur",validator:(a,e,u)=>{e.trim().length>=5?u():u(new Error("密码至少6位"))}}]};let _=s(!1),q=s(""),N=s(""),le=async a=>{N.value=a.id,_.value=!0,q.value=a.name;const e=await H(a.id);e.code==200&&(V.value=e.data.assignRoles,R.value=e.data.allRolesList)},z=s(!1),ae=a=>{console.log(a,3333),V.value=a?R.value:[]};const V=s([]),R=s([]);let te=a=>{console.log(a,555),z.value=R.value.length==V.value.length},E=s({roleIdList:[],userId:""}),oe=async()=>{let a=V.value.map(u=>u.id);console.log(a,888),E.value.roleIdList=a,E.value.userId=N.value,(await Ce(E.value)).code==200?(H(N.value),w({type:"success",message:"修改成功"}),_.value=!1,g()):w({type:"error",message:"修改失败"})},ne=async a=>{let e=s([a.id]);(await J(e.value)).code==200&&(w({type:"success",message:"删除成功"}),g())},T=s([]),re=a=>{T.value=a.map(e=>e.id),console.log(T.value,555)},ue=async()=>{(await J(T.value)).code==200&&(w({type:"success",message:"删除成功"}),g())},k=s(""),B=async()=>{const a=await G(c.value,b.value,k.value);k.value="",a.code==200&&(U.value=a.data.records,I.value=a.data.total)},se=()=>{k.value="",g()};return(a,e)=>{const u=p("el-input"),m=p("el-form-item"),f=p("el-button"),L=p("el-form"),P=p("el-card"),y=p("el-table-column"),de=p("el-table"),ie=p("el-from"),me=p("el-pagination"),$=p("el-drawer"),D=p("el-checkbox"),pe=p("el-checkbox-group");return S(),M(j,null,[l(P,{style:{height:"80px"}},{default:t(()=>[l(L,{inline:!0,style:{position:"relative"}},{default:t(()=>[l(m,{label:"用户管理：",style:{width:"260px"}},{default:t(()=>[l(u,{placeholder:"请输入用户名",modelValue:n(k),"onUpdate:modelValue":e[0]||(e[0]=o=>h(k)?k.value=o:k=o),onKeyup:fe(n(B),["native","enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(m,{style:{position:"absolute",right:"10px"}},{default:t(()=>[l(f,{type:"primary",onClick:n(B)},{default:t(()=>[d("搜索")]),_:1},8,["onClick"]),l(f,{onClick:n(se)},{default:t(()=>[d("重置")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),l(P,{style:{"margin-top":"10px"}},{default:t(()=>[l(ie,null,{default:t(()=>[l(m,null,{default:t(()=>[l(f,{type:"primary",onClick:n(X)},{default:t(()=>[d("添加")]),_:1},8,["onClick"]),l(f,{type:"primary",onClick:n(ue)},{default:t(()=>[d("批量删除")]),_:1},8,["onClick"])]),_:1}),l(m,null,{default:t(()=>[l(de,{border:"",data:n(U),onSelectionChange:n(re)},{default:t(()=>[l(y,{width:"60",type:"selection",align:"center"}),l(y,{label:"#",width:"115",type:"index",align:"center"}),l(y,{label:"id",width:"115",prop:"id"}),l(y,{label:"用户名字",width:"115",prop:"name"}),l(y,{label:"用户名称",width:"115",prop:"username"}),l(y,{label:"用户角色",width:"115",prop:"roleName"}),l(y,{label:"创建时间",width:"115",prop:"createTime"}),l(y,{label:"更新时间",width:"115",prop:"updateTime"}),l(y,{label:"操作"},{default:t(({row:o,$index:ze})=>[l(f,{icon:"User",type:"primary",size:"small",onClick:K=>n(le)(o)},{default:t(()=>[d("分配角色")]),_:2},1032,["onClick"]),l(f,{type:"primary",icon:"Edit",size:"small",onClick:K=>n(Z)(o)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),l(f,{type:"primary",icon:"Delete",size:"small",onClick:K=>n(ne)(o)},{default:t(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),_:1})]),_:1}),A("div",he,[l(me,{style:{"margin-top":"15px"},"current-page":n(c),"onUpdate:currentPage":e[1]||(e[1]=o=>h(c)?c.value=o:c=o),"page-size":n(b),"onUpdate:pageSize":e[2]||(e[2]=o=>h(b)?b.value=o:b=o),"page-sizes":[2,3,5,7,10],background:!0,layout:" prev, pager, next, jumper,->, sizes,total",total:n(I),onSizeChange:n(Q),onCurrentChange:n(W)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),l($,{modelValue:n(v),"onUpdate:modelValue":e[7]||(e[7]=o=>h(v)?v.value=o:v=o),direction:"rtl"},{header:t(()=>[be]),default:t(()=>[A("div",null,[l(L,{model:n(r),rules:ee,ref_key:"formRef",ref:C},{default:t(()=>[l(m,{label:"用户姓名",prop:"username"},{default:t(()=>[l(u,{modelValue:n(r).username,"onUpdate:modelValue":e[3]||(e[3]=o=>n(r).username=o)},null,8,["modelValue"])]),_:1}),l(m,{label:"用户昵称",prop:"name"},{default:t(()=>[l(u,{modelValue:n(r).name,"onUpdate:modelValue":e[4]||(e[4]=o=>n(r).name=o)},null,8,["modelValue"])]),_:1}),n(r).id?ve("",!0):(S(),F(m,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(u,{modelValue:n(r).password,"onUpdate:modelValue":e[5]||(e[5]=o=>n(r).password=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])])]),footer:t(()=>[A("div",ke,[l(f,{onClick:e[6]||(e[6]=o=>h(v)?v.value=!1:v=!1)},{default:t(()=>[d("取消")]),_:1}),l(f,{type:"primary",onClick:n(Y)},{default:t(()=>[d("确认")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),l($,{modelValue:n(_),"onUpdate:modelValue":e[11]||(e[11]=o=>h(_)?_.value=o:_=o),title:"分配角色用户",direction:"rtl"},{footer:t(()=>[A("div",Ve,[l(f,{onClick:e[10]||(e[10]=o=>h(_)?_.value=!1:_=!1)},{default:t(()=>[d("取消")]),_:1}),l(f,{type:"primary",onClick:n(oe)},{default:t(()=>[d("确认")]),_:1},8,["onClick"])])]),default:t(()=>[l(L,null,{default:t(()=>[l(m,{label:"用户姓名"},{default:t(()=>[l(u,{disabled:"true",placeholder:n(q)},null,8,["placeholder"])]),_:1}),l(m,{label:"角色列表"},{default:t(()=>[l(D,{modelValue:n(z),"onUpdate:modelValue":e[8]||(e[8]=o=>h(z)?z.value=o:z=o),onChange:n(ae)},{default:t(()=>[d("全选")]),_:1},8,["modelValue","onChange"]),l(pe,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o),onChange:n(te)},{default:t(()=>[(S(!0),M(j,null,ge(R.value,o=>(S(),F(D,{key:o.id,label:o},{default:t(()=>[d(_e(o.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{Re as default};
